{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/helpers/esm/createClass\";import axios from'axios';import config from'../config';var MAX_RETRY=3;export var httpRequest=/*#__PURE__*/function(){function httpRequest(session){_classCallCheck(this,httpRequest);this.session=session;this.localApiUrl=config.localApiUrl||window.location.origin;}_createClass(httpRequest,[{key:\"getAxiosHeaders\",value:function getAxiosHeaders(){var headers={};if(this.session.getAccessToken()){headers.authorization=\"Bearer \".concat(this.session.getAccessToken());}return headers;}},{key:\"refreshAccessToken\",value:function(){var _refreshAccessToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({baseURL:this.localApiUrl,url:'/api/v1/access_token',method:'post',data:{refresh_token:this.session.getRefreshToken()}});case 2:_ref=_context.sent;data=_ref.data;this.session.setAccessToken(data.access_token);case 5:case\"end\":return _context.stop();}}},_callee,this);}));function refreshAccessToken(){return _refreshAccessToken.apply(this,arguments);}return refreshAccessToken;}()},{key:\"executeQuery\",value:function(){var _executeQuery=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(method,url,query,body){var retryCount,_ref2,data,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:retryCount=_args2.length>4&&_args2[4]!==undefined?_args2[4]:0;if(!(retryCount>MAX_RETRY)){_context2.next=4;break;}this.session.reset();throw new Error('MAX_RETRY_EXCEEDED');case 4:_context2.prev=4;_context2.next=7;return axios({baseURL:this.localApiUrl,url:url,method:method,params:query,data:body,headers:this.getAxiosHeaders()});case 7:_ref2=_context2.sent;data=_ref2.data;console.log(data);return _context2.abrupt(\"return\",data);case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](4);if(!(_context2.t0.response&&_context2.t0.response.status===401)){_context2.next=19;break;}_context2.next=18;return this.refreshAccessToken();case 18:return _context2.abrupt(\"return\",this.executeQuery(method,url,query,body,retryCount+1));case 19:throw _context2.t0;case 20:case\"end\":return _context2.stop();}}},_callee2,this,[[4,13]]);}));function executeQuery(_x,_x2,_x3,_x4){return _executeQuery.apply(this,arguments);}return executeQuery;}()},{key:\"get\",value:function(){var _get=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(url,query){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",this.executeQuery('get',url,query));case 1:case\"end\":return _context3.stop();}}},_callee3,this);}));function get(_x5,_x6){return _get.apply(this,arguments);}return get;}()},{key:\"post\",value:function(){var _post=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(url,body){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",this.executeQuery('post',url,{},body));case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function post(_x7,_x8){return _post.apply(this,arguments);}return post;}()},{key:\"patch\",value:function(){var _patch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(url,body){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",this.executeQuery('patch',url,{},body));case 1:case\"end\":return _context5.stop();}}},_callee5,this);}));function patch(_x9,_x10){return _patch.apply(this,arguments);}return patch;}()},{key:\"delete\",value:function(){var _delete2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(url,body){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",this.executeQuery('delete',url));case 1:case\"end\":return _context6.stop();}}},_callee6,this);}));function _delete(_x11,_x12){return _delete2.apply(this,arguments);}return _delete;}()}]);return httpRequest;}();","map":{"version":3,"sources":["/Users/jeufore/Documents/charlinfo/front/src/actions/httpRequest.js"],"names":["axios","config","MAX_RETRY","httpRequest","session","localApiUrl","window","location","origin","headers","getAccessToken","authorization","baseURL","url","method","data","refresh_token","getRefreshToken","setAccessToken","access_token","query","body","retryCount","reset","Error","params","getAxiosHeaders","console","log","response","status","refreshAccessToken","executeQuery"],"mappings":"ueAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CAEA,GAAMC,CAAAA,SAAS,CAAG,CAAlB,CAEA,UAAaC,CAAAA,WAAb,yBACE,qBAAYC,OAAZ,CAAqB,mCACnB,KAAKA,OAAL,CAAeA,OAAf,CACA,KAAKC,WAAL,CAAmBJ,MAAM,CAACI,WAAP,EAAsBC,MAAM,CAACC,QAAP,CAAgBC,MAAzD,CACD,CAJH,iFAMoB,CAChB,GAAMC,CAAAA,OAAO,CAAG,EAAhB,CACA,GAAI,KAAKL,OAAL,CAAaM,cAAb,EAAJ,CAAmC,CACjCD,OAAO,CAACE,aAAR,kBAAkC,KAAKP,OAAL,CAAaM,cAAb,EAAlC,EACD,CACD,MAAOD,CAAAA,OAAP,CACD,CAZH,oSAe2BT,CAAAA,KAAK,CAAC,CAC3BY,OAAO,CAAE,KAAKP,WADa,CAE3BQ,GAAG,CAAE,sBAFsB,CAG3BC,MAAM,CAAE,MAHmB,CAI3BC,IAAI,CAAE,CACJC,aAAa,CAAE,KAAKZ,OAAL,CAAaa,eAAb,EADX,CAJqB,CAAD,CAfhC,2BAeYF,IAfZ,MAeYA,IAfZ,CAuBI,KAAKX,OAAL,CAAac,cAAb,CAA4BH,IAAI,CAACI,YAAjC,EAvBJ,8SA0BqBL,MA1BrB,CA0B6BD,GA1B7B,CA0BkCO,KA1BlC,CA0ByCC,IA1BzC,iKA0B+CC,UA1B/C,kDA0B4D,CA1B5D,MA2BQA,UAAU,CAAGpB,SA3BrB,2BA4BM,KAAKE,OAAL,CAAamB,KAAb,GA5BN,KA6BY,IAAIC,CAAAA,KAAJ,CAAU,oBAAV,CA7BZ,gDAgC6BxB,CAAAA,KAAK,CAAC,CAC3BY,OAAO,CAAE,KAAKP,WADa,CAE3BQ,GAAG,CAAHA,GAF2B,CAG3BC,MAAM,CAANA,MAH2B,CAI3BW,MAAM,CAAEL,KAJmB,CAK3BL,IAAI,CAAEM,IALqB,CAM3BZ,OAAO,CAAE,KAAKiB,eAAL,EANkB,CAAD,CAhClC,6BAgCcX,IAhCd,OAgCcA,IAhCd,CAwCMY,OAAO,CAACC,GAAR,CAAYb,IAAZ,EAxCN,iCAyCaA,IAzCb,oEA2CU,aAAEc,QAAF,EAAc,aAAEA,QAAF,CAAWC,MAAX,GAAsB,GA3C9C,oDA4Cc,MAAKC,kBAAL,EA5Cd,0CA6Ce,KAAKC,YAAL,CAAkBlB,MAAlB,CAA0BD,GAA1B,CAA+BO,KAA/B,CAAsCC,IAAtC,CAA4CC,UAAU,CAAG,CAAzD,CA7Cf,iUAmDYT,GAnDZ,CAmDiBO,KAnDjB,uJAoDW,KAAKY,YAAL,CAAkB,KAAlB,CAAyBnB,GAAzB,CAA8BO,KAA9B,CApDX,4PAuDaP,GAvDb,CAuDkBQ,IAvDlB,uJAwDW,KAAKW,YAAL,CAAkB,MAAlB,CAA0BnB,GAA1B,CAA+B,EAA/B,CAAmCQ,IAAnC,CAxDX,iQA2DcR,GA3Dd,CA2DmBQ,IA3DnB,uJA4DW,KAAKW,YAAL,CAAkB,OAAlB,CAA2BnB,GAA3B,CAAgC,EAAhC,CAAoCQ,IAApC,CA5DX,wQA+DeR,GA/Df,CA+DoBQ,IA/DpB,uJAgEW,KAAKW,YAAL,CAAkB,QAAlB,CAA4BnB,GAA5B,CAhEX","sourcesContent":["import axios from 'axios';\nimport config from '../config';\n\nconst MAX_RETRY = 3;\n\nexport class httpRequest {\n  constructor(session) {\n    this.session = session;\n    this.localApiUrl = config.localApiUrl || window.location.origin;\n  }\n\n  getAxiosHeaders() {\n    const headers = {};\n    if (this.session.getAccessToken()) {\n      headers.authorization = `Bearer ${this.session.getAccessToken()}`;\n    }\n    return headers;\n  }\n\n  async refreshAccessToken() {\n    const { data } = await axios({\n      baseURL: this.localApiUrl,\n      url: '/api/v1/access_token',\n      method: 'post',\n      data: {\n        refresh_token: this.session.getRefreshToken()\n      }\n    });\n    this.session.setAccessToken(data.access_token);\n  }\n\n  async executeQuery(method, url, query, body, retryCount = 0) {\n    if (retryCount > MAX_RETRY) {\n      this.session.reset();\n      throw new Error('MAX_RETRY_EXCEEDED');\n    }\n    try {\n      const { data } = await axios({\n        baseURL: this.localApiUrl,\n        url,\n        method,\n        params: query,\n        data: body,\n        headers: this.getAxiosHeaders()\n      });\n      console.log(data)\n      return data;\n    } catch (e) {\n      if (e.response && e.response.status === 401) {\n        await this.refreshAccessToken();\n        return this.executeQuery(method, url, query, body, retryCount + 1);\n      }\n      throw e;\n    }\n  }\n\n  async get(url, query) {\n    return this.executeQuery('get', url, query);\n  }\n\n  async post(url, body) {\n    return this.executeQuery('post', url, {}, body);\n  }\n\n  async patch(url, body) {\n    return this.executeQuery('patch', url, {}, body);\n  }\n\n  async delete(url, body) {\n    return this.executeQuery('delete', url);\n  }\n}"]},"metadata":{},"sourceType":"module"}