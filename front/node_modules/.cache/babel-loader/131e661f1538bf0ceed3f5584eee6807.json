{"ast":null,"code":"import _classCallCheck from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jeufore/Documents/charlinfo/front/node_modules/@babel/runtime/helpers/esm/createClass\";import config from'../config';var Session=/*#__PURE__*/function(){function Session(){_classCallCheck(this,Session);this.user=null;this.profilePicture=null;this.initialized=false;this.websocketConnected=false;this.ws=null;}_createClass(Session,[{key:\"init\",value:function init(){if(this.initialized){return null;}var user=this.getUser();if(user&&this.user.access_token){this.connect();this.initialized=true;}}},{key:\"reset\",value:function reset(){this.user=null;this.profilePicture=null;this.initialized=false;localStorage.clear();}},{key:\"isConnected\",value:function isConnected(){return this.user!==null;}},{key:\"connect\",value:function connect(){var _this=this;console.log('Trying to connect...');var websocketUrl=config.webSocketUrl||window.location.origin.replace('http','ws');this.ws=new WebSocket(websocketUrl);this.ws.onopen=function(){console.log('Connected!');_this.websocketConnected=true;_this.ws.send(JSON.stringify({type:'authenticate.request',payload:{accessToken:_this.user.access_token}}));_this.ws.onmessage=function(e){var data=e.data;var _JSON$parse=JSON.parse(data),type=_JSON$parse.type,payload=_JSON$parse.payload;};};this.ws.onerror=function(e){console.log('Error',e);};this.ws.onclose=function(e){console.log(e);console.log('disconnected');_this.websocketConnected=false;if(e.reason===\"invalid token\"){delete _this.user.access_token;_this.saveUser(_this.user);}else{setTimeout(function(){_this.connect();},1000);}};}},{key:\"getUser\",value:function getUser(){if(this.user){return this.user;}var data=localStorage.getItem('user');if(data){this.user=JSON.parse(data);}return this.user;}},{key:\"getRefreshToken\",value:function getRefreshToken(){if(this.user){return this.user.refresh_token;}return null;}},{key:\"getAccessToken\",value:function getAccessToken(){if(this.user){return this.user.access_token;}return null;}},{key:\"setAccessToken\",value:function setAccessToken(accessToken){var newUser=Object.assign({},this.user,{access_token:accessToken});this.saveUser(newUser);}},{key:\"getProfilePicture\",value:function getProfilePicture(){if(this.profilePicture){return this.profilePicture;}var data=localStorage.getItem('profile_picture');if(data){this.profilePicture=data;}return this.profilePicture;}},{key:\"saveUser\",value:function saveUser(user){var mergedUser=Object.assign({},this.user,user);this.user=mergedUser;localStorage.setItem('user',JSON.stringify(mergedUser));}},{key:\"saveProfilePicture\",value:function saveProfilePicture(profilePicture){this.profilePicture=profilePicture;localStorage.setItem('profile_picture',profilePicture);}}]);return Session;}();export{Session};","map":{"version":3,"sources":["/Users/jeufore/Documents/charlinfo/front/src/actions/Session.js"],"names":["config","Session","user","profilePicture","initialized","websocketConnected","ws","getUser","access_token","connect","localStorage","clear","console","log","websocketUrl","webSocketUrl","window","location","origin","replace","WebSocket","onopen","send","JSON","stringify","type","payload","accessToken","onmessage","e","data","parse","onerror","onclose","reason","saveUser","setTimeout","getItem","refresh_token","newUser","Object","assign","mergedUser","setItem"],"mappings":"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","sourcesContent":["import config from '../config';\n\nclass Session {\n  constructor() {\n    this.user = null;\n    this.profilePicture = null;\n    this.initialized = false;\n    this.websocketConnected = false;\n    this.ws = null;\n  }\n\n  init() {\n    if (this.initialized) {\n      return null;\n    }\n    const user = this.getUser();\n    if (user && this.user.access_token) {\n      this.connect();\n      this.initialized = true;\n    }\n  }\n\n  reset() {\n    this.user = null;\n    this.profilePicture = null;\n    this.initialized = false;\n    localStorage.clear();\n  }\n\n  isConnected() {\n    return this.user !== null;\n  }\n\n  connect() {\n    console.log('Trying to connect...');\n    const websocketUrl = config.webSocketUrl || window.location.origin.replace('http', 'ws');\n    this.ws = new WebSocket(websocketUrl);\n    this.ws.onopen = () => {\n      console.log('Connected!');\n      this.websocketConnected = true;\n      this.ws.send(\n        JSON.stringify({\n          type: 'authenticate.request',\n          payload: {\n            accessToken: this.user.access_token\n          }\n        })\n      );\n      this.ws.onmessage = e => {\n        const { data } = e;\n        const { type, payload } = JSON.parse(data);\n      };\n    };\n    this.ws.onerror = e => {\n      console.log('Error', e);\n    };\n    this.ws.onclose = e => {\n      console.log(e);\n      console.log('disconnected');\n      this.websocketConnected = false;\n      if (e.reason === \"invalid token\") {\n        delete this.user.access_token;\n        this.saveUser(this.user);\n      } else {\n        setTimeout(() => {\n          this.connect();\n        }, 1000);\n      }\n    };\n  }\n\n  getUser() {\n    if (this.user) {\n      return this.user;\n    }\n    const data = localStorage.getItem('user');\n    if (data) {\n      this.user = JSON.parse(data);\n    }\n    return this.user;\n  }\n\n  getRefreshToken() {\n    if (this.user) {\n      return this.user.refresh_token;\n    }\n    return null;\n  }\n\n  getAccessToken() {\n    if (this.user) {\n      return this.user.access_token;\n    }\n    return null;\n  }\n\n  setAccessToken(accessToken) {\n    const newUser = Object.assign({}, this.user, {\n      access_token: accessToken\n    });\n    this.saveUser(newUser);\n  }\n\n  getProfilePicture() {\n    if (this.profilePicture) {\n      return this.profilePicture;\n    }\n    const data = localStorage.getItem('profile_picture');\n    if (data) {\n      this.profilePicture = data;\n    }\n\n    return this.profilePicture;\n  }\n\n  saveUser(user) {\n    const mergedUser = Object.assign({}, this.user, user);\n    this.user = mergedUser;\n    localStorage.setItem('user', JSON.stringify(mergedUser));\n  }\n\n  saveProfilePicture(profilePicture) {\n    this.profilePicture = profilePicture;\n    localStorage.setItem('profile_picture', profilePicture);\n  }\n}\n\nexport { Session };"]},"metadata":{},"sourceType":"module"}